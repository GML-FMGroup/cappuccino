# Cappuccino é¡¹ç›®æ¶æ„

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
cappuccino/
â”œâ”€â”€ server/                         # æœåŠ¡å±‚ï¼ˆå¯¹å¤–æ¥å£ + ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ server.py                   # å¤šå¹³å°åè°ƒå™¨ï¼ˆå¯åŠ¨ + é…ç½®ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ commands.py                 # å‘½ä»¤è§£æå’Œè·¯ç”±ï¼ˆè½»é‡ï¼‰
â”‚   â”œâ”€â”€ messages.py                 # ç»Ÿä¸€æ¶ˆæ¯æ–‡æœ¬å®šä¹‰
â”‚   â”œâ”€â”€ handlers.py                 # ä¸šåŠ¡å¤„ç†å±‚ â­ æ ¸å¿ƒåè°ƒè€…
â”‚   â”‚                               # - åŠ è½½ç”¨æˆ·ä¼šè¯è®°å¿† (user memory)
â”‚   â”‚                               # - æ„å»ºå®Œæ•´ä¸Šä¸‹æ–‡
â”‚   â”‚                               # - è°ƒç”¨ Agent æ‰§è¡Œä»»åŠ¡
â”‚   â”‚                               # - ä¿å­˜ç”¨æˆ·ä¼šè¯è®°å¿†
â”‚   â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•°ï¼ˆSSE ç¼–ç ç­‰ï¼‰
â”‚   â”œâ”€â”€ memory/                     # ä¼šè¯è®°å¿†æ¨¡å—ï¼ˆç”¨æˆ·å¯¹è¯å†å²ï¼‰â­
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ manager.py              # è®°å¿†ç®¡ç†å™¨ï¼ˆåŠ è½½/ä¿å­˜/æ£€ç´¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ storage.py              # å­˜å‚¨åç«¯ï¼ˆSQLiteï¼‰
â”‚   â”‚   â””â”€â”€ context.py              # ä¸Šä¸‹æ–‡æ„å»ºå™¨ï¼ˆæ•´åˆå†å²å¯¹è¯ï¼‰
â”‚   â””â”€â”€ platforms/                  # å¹³å°é€‚é…å±‚ï¼ˆå‡è¡¡çš„æ¶æ„ï¼‰
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ telegram_bot.py         # Telegram Bot (æ¥æ”¶ Telegram API â†’ commands â†’ handlers)
â”‚       â”œâ”€â”€ url_bot.py              # URL/HTTP Bot (æ¥æ”¶ HTTP â†’ commands â†’ handlers)
â”‚       â”œâ”€â”€ discord_bot.py          # Discord Bot (å¾…å®ç°)
â”‚       â””â”€â”€ slack_bot.py            # Slack Bot (å¾…å®ç°)
â”‚
â”œâ”€â”€ agent/                          # Agent æ ¸å¿ƒï¼ˆä»»åŠ¡æ‰§è¡Œå¼•æ“ï¼‰â­ é‡æ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py                    # Agent ä¸»æµç¨‹ç¼–æ’ï¼ˆå¾ªç¯æ‰§è¡Œï¼‰
â”‚   â”œâ”€â”€ planner.py                  # è§„åˆ’å™¨ï¼ˆç»Ÿä¸€è§„åˆ’å’Œåˆ†å‘åŠŸèƒ½ï¼‰â­ æ ¸å¿ƒ
â”‚   â”œâ”€â”€ executor.py                 # æ‰§è¡Œå™¨ï¼ˆæ“æ§ç”µè„‘ï¼‰
â”‚   â”œâ”€â”€ summarizer.py               # ä»»åŠ¡æ€»ç»“å™¨ï¼ˆç”Ÿæˆæœ€ç»ˆæ€»ç»“ï¼‰
â”‚   â”œâ”€â”€ memory.py                   # ä»»åŠ¡ä¸Šä¸‹æ–‡è®°å¿†ï¼ˆä¸ user memory åˆ†ç¦»ï¼‰
â”‚   â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ mcp/                        # MCP å·¥å…·æ¨¡å— â­ 
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ manager.py              # MCP å·¥å…·ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ tools.py                # å·¥å…·å®šä¹‰å’Œæ³¨å†Œ
â”‚   â”‚   â””â”€â”€ client.py               # MCP åè®®å®¢æˆ·ç«¯
â”‚   â””â”€â”€ executors/                  # å†…ç½®æ‰§è¡Œå™¨
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ code_executor.py
â”‚       â”œâ”€â”€ interact_executor.py
â”‚       â””â”€â”€ scroll_executor.py
â”‚
â”œâ”€â”€ config.py                       # ç»Ÿä¸€é…ç½®ç®¡ç†
â”œâ”€â”€ .env                            # ç¯å¢ƒé…ç½®ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                    # é…ç½®æ¨¡æ¿
â”œâ”€â”€ pyproject.toml                  # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md
```

## ğŸ”„ å®Œæ•´è°ƒç”¨é“¾ä¸ Agent æ‰§è¡Œå¾ªç¯

```
â”Œâ”€ Telegram æ¶ˆæ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€ HTTP è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (text/command)              â”‚         â”‚ (/chat, /screenshot)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“                                      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TelegramBotService     â”‚            â”‚ URLBotService          â”‚
  â”‚ (æ¥æ”¶ Telegram API)    â”‚            â”‚ (æ¥æ”¶ HTTP è¯·æ±‚)       â”‚
  â”‚ - æƒé™æ£€æŸ¥             â”‚            â”‚ - Token éªŒè¯           â”‚
  â”‚ - è§£ææ–‡æœ¬æ¶ˆæ¯         â”‚            â”‚ - è§£æè¯·æ±‚ body        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“                                    â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Commands å±‚ (commands.py) â­ ç»Ÿä¸€å…¥å£                      â”‚
  â”‚                                                            â”‚
  â”‚ parse_command(text) â†’ (CommandType, arg)                 â”‚
  â”‚                                                            â”‚
  â”‚ â”œâ”€ /start      â†’ handle_start()                          â”‚
  â”‚ â”œâ”€ /help       â†’ handle_help()                           â”‚
  â”‚ â”œâ”€ /screenshot â†’ handle_screenshot()                     â”‚
  â”‚ â””â”€ /run or text â†’ handle_run()                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Handlers å±‚ (handlers.py) â­ ä¸šåŠ¡åè°ƒè€…                    â”‚
  â”‚                                                            â”‚
  â”‚ execute_task(user_id, query, request_config):            â”‚
  â”‚ 1. MemoryManager.load(user_id)      [user memory]        â”‚
  â”‚    â””â†’ åŠ è½½ç”¨æˆ·å†å²å¯¹è¯è®°å¿†                                â”‚
  â”‚ 2. ContextBuilder.build(query, memory)                   â”‚
  â”‚    â””â†’ æ„å»ºåŒ…å«è®°å¿†çš„å®Œæ•´ä¸Šä¸‹æ–‡                            â”‚
  â”‚ 3. Agent(context, mcp_config).execute()                  â”‚
  â”‚    â””â†’ è°ƒç”¨ Agent æ‰§è¡Œï¼ˆå†…éƒ¨å¾ªç¯ï¼‰                        â”‚
  â”‚ 4. MemoryManager.save(user_id, result)  [user memory]    â”‚
  â”‚    â””â†’ ä¿å­˜æœ¬æ¬¡å¯¹è¯åˆ°è®°å¿†                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ Agent å±‚ (agent.py) â­ ä»»åŠ¡æ‰§è¡Œå¼•æ“ [ç»Ÿä¸€ Planner]         â•‘
  â•‘                                                            â•‘
  â•‘ åˆå§‹åŒ–: TaskContextMemory(task_id, user_query)          â•‘
  â•‘                                                            â•‘
  â•‘ â”Œâ”€ æ­¥éª¤ 1: Planner.plan() ç”Ÿæˆåˆå§‹è§„åˆ’              â”  â•‘
  â•‘ â”‚ plan = planner.plan(user_query)                     â”‚  â•‘
  â•‘ â”‚ task_memory.user_query = plan                       â”‚  â•‘
  â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
  â•‘                   â†“                                     â•‘  â•‘
  â•‘ â•”â”€ å¼€å§‹å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
  â•‘ â•‘ while iteration < max_iterations:                   â•‘  â•‘
  â•‘ â•‘                                                     â•‘  â•‘
  â•‘ â•‘ â”Œâ”€ Planner.dispatch: æ ¹æ®è§„åˆ’ã€å†å²3ä¸ªåŠ¨ä½œã€å½“å‰æˆªå›¾ â”  â•‘
  â•‘ â•‘ â”‚ action = planner.dispatch(task_memory)           â”‚  â•‘
  â•‘ â•‘ â”‚                                                  â”‚  â•‘
  â•‘ â•‘ â”‚ è¿”å›: {                                          â”‚  â•‘
  â•‘ â•‘ â”‚   "type": "execute|modify_plan|end",          â”‚  â•‘
  â•‘ â•‘ â”‚   "params": {...}                              â”‚  â•‘
  â•‘ â•‘ â”‚ }                                               â”‚  â•‘
  â•‘ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
  â•‘ â•‘                   â†“                                  â•‘  â•‘
  â•‘ â•‘ â”Œâ”€ åŠ¨ä½œå¤„ç†                                       â”  â•‘
  â•‘ â•‘ â”‚ if action["type"] == "execute":               â”‚  â•‘
  â•‘ â•‘ â”‚   result = executor.execute(action["params"]) â”‚  â•‘
  â•‘ â•‘ â”‚                                                 â”‚  â•‘
  â•‘ â•‘ â”‚ elif action["type"] == "modify_plan":         â”‚  â•‘
  â•‘ â•‘ â”‚   task_memory.user_query = new_plan          â”‚  â•‘
  â•‘ â•‘ â”‚                                                 â”‚  â•‘
  â•‘ â•‘ â”‚ elif action["type"] == "end":                â”‚  â•‘
  â•‘ â•‘ â”‚   break  # ç»“æŸå¾ªç¯                            â”‚  â•‘
  â•‘ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
  â•‘ â•‘                   â†“                                  â•‘  â•‘
  â•‘ â•‘ â”Œâ”€ æ›´æ–° TaskContextMemory                       â”  â•‘
  â•‘ â•‘ â”‚ task_memory.add_dispatcher_action(             â”‚  â•‘
  â•‘ â•‘ â”‚    action_type,                               â”‚  â•‘
  â•‘ â•‘ â”‚    params,                                    â”‚  â•‘
  â•‘ â•‘ â”‚    result                                     â”‚  â•‘
  â•‘ â•‘ â”‚ )                                             â”‚  â•‘
  â•‘ â•‘ â”‚ (è‡ªåŠ¨ä¿æŒæœ€è¿‘3ä¸ªåŠ¨ä½œ)                         â”‚  â•‘
  â•‘ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
  â•‘ â•‘                   â†“                                  â•‘  â•‘
  â•‘ â•‘     iteration += 1                                  â•‘  â•‘
  â•‘ â•‘                                                     â•‘  â•‘
  â•‘ â•šâ”€ ç»“æŸå¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•  â•‘
  â•‘                   â†“                                     â•‘  â•‘
  â•‘ â”Œâ”€ Summarizer: ç”Ÿæˆæœ€ç»ˆæ€»ç»“ â­                   â”  â•‘
  â•‘ â”‚ summary = summarizer(                             â”‚  â•‘
  â•‘ â”‚    task_memory.user_query,                      â”‚  â•‘
  â•‘ â”‚    task_memory.dispatcher_actions                â”‚  â•‘
  â•‘ â”‚ )                                                â”‚  â•‘
  â•‘ â”‚ â†’ {summary: str, actions: list}                 â”‚  â•‘
  â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ è¿”å›æœ€ç»ˆç»“æœ                                              â”‚
  â”‚                                                            â”‚
  â”‚ - å‘å› Telegram æ¶ˆæ¯ (final_summary)                      â”‚
  â”‚ - è¿”å› HTTP SSE æµ (final_summary + actions)             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å„å±‚èŒè´£

### Server å±‚ï¼ˆä¸šåŠ¡ + æ¥å£ï¼‰

#### 1. Commands (commands.py)
- **èŒè´£**: å‘½ä»¤è§£æå’Œè·¯ç”±ï¼ˆè½»é‡çº§ï¼‰
- **åŠŸèƒ½**:
  - è§£æå‘½ä»¤ç±»å‹ (/start, /help, /run, /screenshot)
  - ç®€å•å‘½ä»¤ç›´æ¥å¤„ç†ï¼ˆstart, help, screenshotï¼‰
  - å¤æ‚ä»»åŠ¡å§”æ‰˜ç»™ handlers

#### 2. Handlers (handlers.py) â­ **æ ¸å¿ƒåè°ƒè€…**
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘ç¼–æ’
- **åŠŸèƒ½**:
  - åŠ è½½ç”¨æˆ·ä¼šè¯è®°å¿† (User Memory - å¯¹è¯å†å²)
  - æ„å»ºåŒ…å«å†å²ä¸Šä¸‹æ–‡çš„å®Œæ•´ prompt
  - è°ƒç”¨ Agent æ‰§è¡Œä»»åŠ¡
  - å¤„ç† Agent è¿”å›çš„æœ€ç»ˆæ€»ç»“
  - ä¿å­˜ç”¨æˆ·ä¼šè¯è®°å¿†

#### 3. Memory (memory/) - ç”¨æˆ·å¯¹è¯å†å²
- **èŒè´£**: ä¼šè¯è®°å¿†ç®¡ç†ï¼ˆä¸ç”¨æˆ·äº¤äº’çš„å†å²ï¼‰
- **æ¨¡å—**:
  - `manager.py`: è®°å¿†åŠ è½½/ä¿å­˜/æ£€ç´¢æ¥å£
  - `storage.py`: å­˜å‚¨åç«¯å®ç°ï¼ˆSQLiteï¼‰
  - `context.py`: ä¸Šä¸‹æ–‡æ„å»ºå™¨ï¼ˆæ•´åˆå†å²å¯¹è¯ï¼‰

#### 4. Platforms (platforms/)
- **èŒè´£**: å¹³å° API å¯¹æ¥
- **åŠŸèƒ½**: åªç®¡æ”¶å‘æ¶ˆæ¯ï¼Œä¸å¤„ç†ä¸šåŠ¡é€»è¾‘

### Agent å±‚ï¼ˆä»»åŠ¡æ‰§è¡Œå¼•æ“ï¼‰â­ é‡æ„

#### 1. Agent (agent.py) - ä¸»æµç¨‹ç¼–æ’
- **èŒè´£**: ä»»åŠ¡æ‰§è¡Œå¾ªç¯å’Œåè°ƒ
- **æµç¨‹**: 
  ```
  1. åˆå§‹è§„åˆ’: Planner.plan() ç”Ÿæˆæ€»ä½“è§„åˆ’
  2. Loop (ç›´åˆ° Planner.dispatch è¿”å› end æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°):
     - Planner.dispatch: æ ¹æ®è§„åˆ’ã€æœ€è¿‘3æ¬¡åŠ¨ä½œã€å½“å‰æˆªå›¾å†³å®šä¸‹ä¸€æ­¥
       - execute: æ‰§è¡Œå…·ä½“æ“ä½œ
       - modify_plan: ä¿®æ”¹è§„åˆ’
       - end: ä»»åŠ¡å®Œæˆ
     - Executor: æ‰§è¡Œç›¸å…³æ“ä½œ
     - æ›´æ–° TaskContextMemory
  â†“
  3. Summarizer: ç”Ÿæˆæœ€ç»ˆæ€»ç»“
  ```

#### 2. Planner (planner.py) - ç»Ÿä¸€è§„åˆ’å™¨ â­ æ ¸å¿ƒ
- **èŒè´£**: åˆå§‹è§„åˆ’ + æ‰§è¡Œå†³ç­–ï¼ˆåˆå¹¶äº†åŸæ¥çš„ Planner å’Œ Dispatcherï¼‰
- **ä¸¤ç§æ¨¡å¼**:

  **plan() - åˆå§‹è§„åˆ’æ¨¡å¼**
  - è¾“å…¥: ç”¨æˆ·æŸ¥è¯¢ (user_query)
  - è¾“å‡º: å®Œæ•´çš„æ‰§è¡Œè§„åˆ’
  - è°ƒç”¨æ—¶æœº: ä»»åŠ¡åˆå§‹åŒ–æ—¶

  **dispatch() - æ‰§è¡Œå†³ç­–æ¨¡å¼**
  - è¾“å…¥: æ€»è§„åˆ’ã€æœ€è¿‘3æ¬¡åŠ¨ä½œå†å²ã€å½“å‰æˆªå›¾
  - è¾“å‡ºåŠ¨ä½œç±»å‹:
    1. **execute** - æ‰§è¡Œå…·ä½“æ“ä½œ (å‚æ•°: executor, action)
    2. **modify_plan** - ä¿®æ”¹æ€»è§„åˆ’ (å‚æ•°: new_plan)
    3. **end** - ä»»åŠ¡å®Œæˆ
  - è°ƒç”¨æ—¶æœº: å¾ªç¯ä¸­æ¯æ¬¡è¿­ä»£
- **èŒè´£**: ç”µè„‘æ“æ§åŠ¨ä½œæ‰§è¡Œ
- **å†…ç½®æ‰§è¡Œå™¨**:
  - `code_executor`: æ‰§è¡Œ Python ä»£ç 
  - `interact_executor`: æ¨¡æ‹Ÿé”®ç›˜/é¼ æ ‡äº¤äº’
  - `scroll_executor`: æ»šåŠ¨å±å¹•
- **è¿”å›**: åŠ¨ä½œæ‰§è¡Œç»“æœ + å±å¹•çŠ¶æ€å˜åŒ–

#### 3. Summarizer (summarizer.py) - ä»»åŠ¡æ€»ç»“å™¨
- **èŒè´£**: ç”Ÿæˆæœ€ç»ˆä»»åŠ¡æ€»ç»“
- **åŠŸèƒ½**:
  - åŸºäº user_query å’Œ task_memory ç”Ÿæˆæ€»ç»“
  - åˆ—å‡ºæ‰§è¡Œçš„æ‰€æœ‰åŠ¨ä½œå’Œæ­¥éª¤
  - æä¾›æœ€ç»ˆç»“æœç»™ç”¨æˆ·
  - è¾“å‡ºæ ¼å¼: `{summary: str, actions: list, result: str}`

#### 4. TaskContextMemory (memory.py) - ä»»åŠ¡ä¸Šä¸‹æ–‡è®°å¿†
- **èŒè´£**: å­˜å‚¨å½“å‰ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ï¼ˆä¸ User Memory åˆ†ç¦»ï¼‰
- **åŠŸèƒ½**:
  - åˆå§‹åŒ–: `TaskContextMemory(task_id, user_query, run_folder)`
  - è®°å½•ä¿¡æ¯:
    - æ€»è§„åˆ’ (user_query)
    - å½“å‰æ‰§è¡Œæ­¥éª¤æ•°
    - æœ€è¿‘næ¬¡ dispatcher åŠ¨ä½œå†å²
    - å½“å‰æˆªå›¾è·¯å¾„
    - ä»»åŠ¡çŠ¶æ€
  - æœ€è¿‘næ¬¡ dispatcher åŠ¨ä½œä¼šè‡ªåŠ¨ç»´æŠ¤ï¼ˆåªä¿ç•™æœ€æ–°3æ¡ï¼‰
  - åœ¨å†…å­˜ä¸­ç»´æŠ¤ï¼Œä»»åŠ¡ç»“æŸåæ¸…ç†ï¼ˆä¸æŒä¹…åŒ–ï¼‰
- **è¿”å›**: åŠ¨ä½œæ‰§è¡Œç»“æœ + å±å¹•çŠ¶æ€å˜åŒ–

#### 5. Summarizer (summarizer.py) â­ æ–°å¢ - ä»»åŠ¡æ€»ç»“å™¨
- **èŒè´£**: ç”Ÿæˆæœ€ç»ˆä»»åŠ¡æ€»ç»“
- **åŠŸèƒ½**:
  - åŸºäº user_query å’Œ dispatcher_actions ç”Ÿæˆæ€»ç»“
  - åˆ—å‡ºæ‰§è¡Œçš„æ‰€æœ‰åŠ¨ä½œå’Œæ­¥éª¤
  - æä¾›æœ€ç»ˆç»“æœç»™ç”¨æˆ·
  - è¾“å‡ºæ ¼å¼: `{summary: str, actions: list}`

### å†…å­˜ç³»ç»Ÿå¯¹æ¯”

| ç»´åº¦ | User Memory (server/memory/) | Task Context Memory (agent/memory.py) |
|------|------|------|
| **å­˜å‚¨ä½ç½®** | ç”¨æˆ·æ•°æ®åº“ (SQLite) | Agent å†…å­˜ï¼ˆä»»åŠ¡ç»“æŸæ¸…ç†ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | è·¨å¤šä¸ªä»»åŠ¡ã€æ°¸ä¹…ä¿å­˜ | å•ä¸ªä»»åŠ¡å†…ã€ä¸´æ—¶å­˜å‚¨ |
| **å†…å®¹** | ç”¨æˆ·å†å²å¯¹è¯ã€äº¤äº’è®°å½• | å½“å‰ä»»åŠ¡çš„æ‰§è¡Œæ­¥éª¤ã€å±å¹•çŠ¶æ€ã€MCP ç»“æœ |
| **è®¿é—®æ—¶æœº** | Handlers åŠ è½½ (task å¼€å§‹æ—¶) | Planner ä½¿ç”¨ (loop å†…) |
| **æ›´æ–°æ—¶æœº** | Handlers ä¿å­˜ (task ç»“æŸæ—¶) | Planner æ›´æ–° (æ¯ä¸ªæ­¥éª¤å) |
| **ç”¨é€”** | ç»´æŒå¯¹è¯è¿è´¯æ€§ | æ”¯æŒè§„åˆ’è¿­ä»£å’ŒåŠ¨æ€å†³ç­– |

